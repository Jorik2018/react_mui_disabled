import{t as k,j as e,i as E,aj as M,v as T,r as o,l as D,n as z,q as d,k as B,R as G,z as V,x,D as H,B as h,y as O}from"./index-98cf31d0.js";import{V as J,a as f,R as j}from"./useToken-eab832c7.js";import{A as g,a as b}from"./AccordionDetails-b2f633b0.js";import{A as y}from"./AccordionSummary-b7f1a4a9.js";import{E as v}from"./ExpandMore-40b166d0.js";import{T as s,F as _}from"./TextField-4e8958de.js";const C=k(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save"),$=()=>{const i=E();M(),T();const l=o.createRef(),c=D();o.useState({});const[r,{defaultProps:t,handleChange:K,bindEvents:P,validate:S,set:p}]=z(o.useState,{status:"1"}),[A]=o.useState(!0);o.useEffect(()=>{i({type:"title",title:"Mi cuenta"});const a={query:`query{
          user {
            uid,
            name
            mail,
            directoryId,
            people{
              code
              fullName
              sex
              names
              firstSurname
              lastSurname
              address
              birthdate
            }
          }}`};d.gql("/api/admin/graphql",a).then(n=>{p(n.user)})},[]);const{width:w,height:m}=B(G);o.useEffect(()=>{if(l.current){const a=document.querySelector(".MuiToolbar-root"),[n,u]=l.current.children;n.style.height=m-a.offsetHeight-0+"px"}},[w,m]);const I=()=>{c("/user/create",{replace:!0})},q=()=>{console.log(r),d.post("/api/auth/change-password",{current:r.current,new:r.new,confirm:r.confirm}).then(a=>{a.changed&&(p({...r,current:null,new:null,confirm:null}),i({type:"snack",msg:"Contraseña cambiada!"}))})},L=()=>{const a=l.current;let n=JSON.parse(JSON.stringify(r));delete n.roles,a!=null&&S(a)?(console.log(n),d.post("/api/admin/user",n).then(u=>{i({type:"snack",msg:"Registro grabado!"}),r.uid||(u.uid?c("/user/"+u.uid+"/edit",{replace:!0}):c(-1))})):i({type:"alert",msg:"Falta campos por completar!"})};o.useEffect(()=>{const a=l.current;if(a!=null)return P(a)},[r,A]);const F=a=>console.log(a),N=V({components:{MuiInput:{defaultProps:{required:!0}}}});function R(){return e.jsx(H,{theme:N,children:e.jsxs("form",{ref:l,onSubmit:F,style:{textAlign:"left"},children:[e.jsxs(x,{style:{overflow:"auto"},children:[e.jsxs(g,{expanded:!0,children:[e.jsx(y,{expandIcon:e.jsx(v,{}),children:"Información General"}),e.jsxs(b,{children:[e.jsx(s,{label:"Nombre de usuario",...t("name"),inputProps:{maxLength:50}}),e.jsx(s,{label:"Dirección de correo electrónico",...t("mail"),inputProps:{maxLength:50}}),e.jsx(s,{...t("mainPhone",{required:!1,InputProps:{}}),label:"Teléfono fijo / Celular"}),e.jsx(s,{...t("people.code"),inputProps:{readOnly:!0},label:"Número DNI/C. Extranjeria"}),e.jsx(s,{label:"Nombres",...t("people.names"),inputProps:{maxLength:50}}),e.jsx(s,{label:"Ap. Paterno",...t("people.firstSurname"),inputProps:{maxLength:50}}),e.jsx(s,{label:"Ap. Materno",...t("people.lastSurname"),inputProps:{maxLength:50}}),e.jsxs(J,{...t("people.sex"),label:"Sexo",children:[e.jsx(f,{value:"F",control:e.jsx(j,{}),label:"Femenino"}),e.jsx(f,{value:"M",control:e.jsx(j,{}),label:"Masculino"})]}),e.jsx(s,{multiline:!0,label:"Dirección",...t("people.address",{required:!1}),inputProps:{maxLength:50}}),e.jsx("div",{style:{paddingTop:10,textAlign:"right"},children:e.jsx(h,{variant:"contained",onClick:L,color:"primary",endIcon:e.jsx(C,{}),children:"Grabar"})})]})]}),e.jsxs(g,{children:[e.jsx(y,{expandIcon:e.jsx(v,{}),children:"Cambiar contraseña"}),e.jsxs(b,{children:[e.jsx(s,{type:"password",label:"Contraseña Actual",...t("current",{required:!1}),inputProps:{maxLength:50}}),e.jsx(s,{type:"password",label:"Contraseña Nueva",...t("new",{required:!1}),inputProps:{maxLength:50}}),e.jsx(s,{type:"password",label:"Confirmar Contraseña Nueva",...t("confirm",{required:!1}),inputProps:{maxLength:50}}),e.jsx("div",{style:{paddingTop:10,textAlign:"right"},children:e.jsx(h,{variant:"contained",disabled:!r.current||!r.new||!r.confirm||r.confirm!==r.new,onClick:q,color:"primary",endIcon:e.jsx(C,{}),children:"Grabar"})})]})]})]}),r._id&&e.jsx(_,{color:"primary","aria-label":"add",onClick:I,style:{position:"absolute",bottom:80,right:24},children:e.jsx(O,{})})]})})}return e.jsx(e.Fragment,{children:e.jsx(x,{style:{textAlign:"left"},children:R()})})};export{$ as Form};
