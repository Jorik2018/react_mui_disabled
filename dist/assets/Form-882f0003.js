import{t as k,j as e,i as B,v as D,r as n,l as w,n as O,q as b,k as G,R as V,z as H,x as C,D as J,I as x,y as v,C as U,B as P}from"./index-98cf31d0.js";import{V as S,a as d,R as h,F as W}from"./useToken-eab832c7.js";import{A as $,a as Q}from"./AccordionDetails-b2f633b0.js";import{T as a,a as X,b as Y,F as Z}from"./TextField-4e8958de.js";import{I as ee,S as re}from"./InputAdornment-867b3a31.js";import{S as oe,a as te}from"./Stack-ad058a13.js";const se=k(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel"),le=k(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit"),pe=()=>{const j=B(),{uid:u}=D(),i=n.createRef(),p=w(),[c,f]=n.useState({}),[l,{defaultProps:s,handleChange:A,bindEvents:I,validate:F,set:R}]=O(n.useState,{status:"1"}),[L]=n.useState(!0);n.useEffect(()=>{j({type:"title",title:(u?"Editar":"Agregar")+" Usuario"})},[]),n.useEffect(()=>{if(u){const r={query:`query{
          user(uid:${u} roleName:"disabled_") {
            uid,
            name
            mail,
            directoryId,
            status
            people{
              code
              fullName
              sex
              names
              firstSurname
              lastSurname
              address
              birthdate
            }
            userRoles {
              pK {
                rid
              },
              role{
                name
              },
              active
            }
          }}`};b.gql("/api/admin/graphql",r).then(t=>{t.user.roles=t.user.userRoles.map(o=>(console.log(o),o.PK=o.pK,t.user["role_"+o.pK.rid]=!!o.active,{value:o.pK.rid,label:o.role.name.replace("_"," ").split(" ").map(m=>m.charAt(0).toUpperCase()+m.slice(1)).join(" ")})),console.log(t.user.roles),R(t.user)})}},[u]);const{width:g,height:y}=G(V);n.useEffect(()=>{if(i.current){const r=document.querySelector(".MuiToolbar-root"),[t,o]=i.current.children,m=document.querySelector("nav");t.style.height=y-r.offsetHeight-o.offsetHeight+"px",o.style.width=g-m.offsetWidth+"px"}},[g,y]);const E=()=>{p(-1)},q=()=>{p("/user/create",{replace:!0})},N=()=>{b.post("/api/reniec",{code:l.people.code},r=>(delete r.Authorization,r)).then(r=>{console.log(r)})},M=()=>{const r=i.current;let t=JSON.parse(JSON.stringify(l));t.userRoles.forEach(o=>{o.active=!!t["role_"+o.PK.rid],delete t["role_"+o.PK.rid]}),delete t.roles,c.editPeople||delete t.people,r!=null&&F(r)?b.post("/api/admin/user",t).then(o=>{j({type:"snack",msg:"Registro grabado!"}),l.uid||(o.uid?p("/user/"+o.uid+"/edit",{replace:!0}):p(-1))}):j({type:"alert",msg:"Falta campos por completar!"})};n.useEffect(()=>{const r=i.current;if(r!=null)return I(r)},[l,L]);const _=r=>console.log(r),z=H({components:{MuiInput:{defaultProps:{required:!0}}}});function K(){return e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"contained",onClick:E,color:"primary",children:"Cancelar"}),e.jsx(P,{variant:"contained",onClick:M,color:"primary",endIcon:e.jsx(te,{}),children:"Grabar"})]})}function T(){return e.jsx(J,{theme:z,children:e.jsxs("form",{ref:i,onSubmit:_,style:{textAlign:"left"},children:[e.jsx(C,{style:{overflow:"auto"},children:e.jsx($,{expanded:!0,children:e.jsxs(Q,{children:[e.jsx(a,{label:"Nombre de usuario",...s("name"),inputProps:{maxLength:50}}),e.jsx(a,{label:"Dirección de correo electrónico",...s("mail"),inputProps:{maxLength:50}}),e.jsxs("fieldset",{style:{margin:0,borderColor:"#0000003b",borderRadius:4.4,borderWidth:1,marginTop:20},children:[e.jsxs("legeng",{children:["Información Personal",e.jsxs("div",{style:{float:"right"},children:[l.directoryId?e.jsx(x,{"aria-label":"edit",disabled:c.editPeople,color:"primary",onClick:()=>{f(r=>({...r,editPeople:!0}))},children:e.jsx(le,{})}):e.jsx(x,{"aria-label":"add",disabled:c.editPeople,color:"primary",onClick:()=>{f(r=>({...r,editPeople:!0}))},children:e.jsx(v,{})}),e.jsx(x,{"aria-label":"cancel",disabled:!c.editPeople,color:"primary",onClick:()=>{f(r=>({...r,editPeople:!1}))},children:e.jsx(se,{})})]})]}),c.editPeople?e.jsxs(e.Fragment,{children:[e.jsx(a,{label:"Numero Documento",...s("people.code"),InputProps:{maxLength:10,style:{textAlign:"center"},endAdornment:e.jsx(ee,{position:"end",children:e.jsx(x,{onClick:N,variant:"contained",color:"primary",children:e.jsx(re,{})})})}}),e.jsx(a,{label:"Nombres",...s("people.names"),inputProps:{maxLength:50}}),e.jsx(a,{label:"Ap. Paterno",...s("people.firstSurname"),inputProps:{maxLength:50}}),e.jsx(a,{label:"Ap. Materno",...s("people.lastSurname"),inputProps:{maxLength:50}}),e.jsxs(S,{...s("people.sex"),label:"Sexo",children:[e.jsx(d,{value:"F",control:e.jsx(h,{}),label:"Femenino"}),e.jsx(d,{value:"M",control:e.jsx(h,{}),label:"Masculino"})]}),e.jsx(a,{multiline:!0,label:"Dirección",...s("people.address"),inputProps:{maxLength:50}})]}):e.jsx(a,{label:"Nombre Completo",multiline:!0,...s("people.fullName"),inputProps:{readOnly:!0}})]}),e.jsx(a,{type:"password",label:"Contraseña",...s("pass",{required:!1}),inputProps:{maxLength:50}}),e.jsxs(S,{...s("status"),label:"Estado",children:[e.jsx(d,{value:"1",control:e.jsx(h,{}),label:"Activo"}),e.jsx(d,{value:"0",control:e.jsx(h,{}),label:"Bloqueado"})]}),e.jsx(a,{...s("mainPhone",{required:!1}),label:"Teléfono fijo / Celular"}),l.roles&&l.roles.length?e.jsx(X,{children:e.jsxs(W,{children:[e.jsx(Y,{children:"Roles"}),(l.roles||[]).map((r,t)=>e.jsx(d,{control:e.jsx(U,{name:"role_"+r.value,value:r.value,checked:l["role_"+r.value]??!1,onChange:A}),label:r.label},t))]})}):null]})})}),e.jsx(oe,{direction:"row",justifyContent:"center",style:{padding:"10px",backgroundColor:"#1976d2"},alignItems:"center",spacing:1,children:K()}),l._id&&e.jsx(Z,{color:"primary","aria-label":"add",onClick:q,style:{position:"absolute",bottom:80,right:24},children:e.jsx(v,{})})]})})}return e.jsx(e.Fragment,{children:e.jsx(C,{style:{textAlign:"left"},children:T()})})};export{pe as Form};
